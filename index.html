<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skin Diary — Skincare Tracker</title>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small tweaks to better match mockup */
    .glass { background: rgba(255,255,255,0.8); }
    .card-shadow { box-shadow: 0 6px 18px rgba(20,20,20,0.06); }
    .rounded-12 { border-radius: 12px; }
    .progress-bar { height: 10px; border-radius: 999px; background: #f3f3f3; overflow:hidden; }
    .progress-bar > div { height:100%; background: linear-gradient(90deg,#f7b7b3,#e07d79); width:0% }
  </style>
</head>
<body class="bg-gradient-to-r from-pink-50 to-green-50 text-gray-800 antialiased">
  <div class="max-w-[1200px] mx-auto p-6">
    <!-- Header -->
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-6">
        <div class="text-2xl font-serif text-emerald-700">
          <span class="font-light">SKIN</span> <span class="font-semibold text-rose-400">DIARY</span>
        </div>
        <nav class="flex gap-3 items-center">
          <button data-scroll="top" class="px-3 py-2 rounded-md hover:bg-white/60">Home</button>
          <button data-scroll="reminders" class="px-3 py-2 rounded-md hover:bg-white/60">Reminders</button>
          <button data-scroll="routines" class="px-3 py-2 rounded-md hover:bg-white/60">Routine</button>
          <button data-scroll="notes" class="px-3 py-2 rounded-md hover:bg-white/60">Notes</button>
        </nav>
      </div>

      <div class="flex items-center gap-3">
        <!-- removed Add Note per request -->
        <button id="notifToggle" class="px-4 py-2 rounded-full border text-sm bg-rose-50">Enable Notifications</button>
        <div id="profileWrap"></div>
      </div>
    </header>

    <!-- Main layout -->
    <main class="grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6">
      <!-- Left column -->
      <div>
        <!-- Hero -->
        <section id="top" class="card-shadow glass rounded-12 p-6 mb-6 flex gap-5">
          <div class="flex-1">
            <h1 class="text-3xl font-serif mb-2">Your Radiance, Remembered.</h1>
            <p class="text-sm text-gray-500 mb-4">Track rutinitas skincare-mu. Pilih produk di <span class="font-medium">Start Routine</span> untuk membuat jadwal otomatis sesuai petunjuk pemakaian.</p>
            <div class="flex gap-3">
              <button id="startRoutineBtn" class="px-4 py-2 rounded-full bg-rose-400 text-white">Start Routine</button>
              <button id="viewNotes" class="px-4 py-2 rounded-full border bg-white/80">View Notes</button>
            </div>
          </div>
          <div class="w-72 h-40 rounded-md overflow-hidden bg-gradient-to-r from-rose-50 to-emerald-50 flex items-center justify-center">
            <!-- placeholder image -->
            <img src="https://images.unsplash.com/photo-1519125323398-675f0ddb6308?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=7b6e5a4a0f4a2be9a1a7c3c1c1b2a9a5" alt="hero" class="w-full h-full object-cover"/>
          </div>
        </section>

        <!-- Today's Routine -->
        <section id="routines" class="card-shadow bg-white rounded-12 p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="font-semibold text-lg">Today's Routine</h2>
            <div id="progressText" class="text-sm text-gray-500">0 / 0 completed</div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Morning -->
            <div>
              <div class="text-sm text-gray-500 mb-2">Morning</div>
              <div id="morningList" class="flex flex-col gap-3"></div>
            </div>

            <!-- Evening -->
            <div>
              <div class="text-sm text-gray-500 mb-2">Evening</div>
              <div id="eveningList" class="flex flex-col gap-3"></div>
            </div>
          </div>

          <div class="mt-4">
            <div class="progress-bar"><div id="progressBar"></div></div>
          </div>
        </section>

        <!-- Notes -->
        <section id="notes" class="card-shadow bg-white rounded-12 p-6 mb-6">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold">Recent Notes</h3>
            <button id="addNoteBtn" class="text-sm px-3 py-1 rounded-md border">+ Note</button>
          </div>
          <div id="noteList" class="min-h-[80px] text-sm text-gray-500">No notes yet — add quick notes to generate logs.</div>
        </section>

        <!-- Footer note and about -->
        <footer class="text-sm text-gray-500">
          <div>Data hanya disimpan di browser ini (localStorage).</div>
          <div class="mt-1">About / Contact: <a href="https://renonovriansyah.github.io/profil" target="_blank" class="text-emerald-700 underline">renonovriansyah.github.io/profil</a></div>
        </footer>
      </div>

      <!-- Right column (aside) -->
      <aside class="space-y-4">
        <!-- Next Reminders -->
        <div class="card-shadow bg-white rounded-12 p-4">
          <h4 class="font-semibold mb-3">Next Reminders</h4>
          <div id="nextReminders" class="flex flex-col gap-2 text-sm text-gray-600">
            <div class="text-gray-400">No reminders scheduled. Start a routine to create reminders.</div>
          </div>
        </div>

        <!-- Weekly Diagram -->
        <div class="card-shadow bg-white rounded-12 p-4">
          <h4 class="font-semibold mb-3">Weekly Diagram</h4>
          <canvas id="weeklyChart" class="w-full h-36"></canvas>
        </div>

        <!-- Quick Actions -->
        <div class="card-shadow bg-white rounded-12 p-4">
          <h4 class="font-semibold mb-3">Quick Actions</h4>
          <div class="flex flex-col gap-2">
            <button id="markMorningDone" class="px-3 py-2 rounded-md border text-sm">Mark Morning Done</button>
            <button id="markNightDone" class="px-3 py-2 rounded-md border text-sm">Mark Night Done</button>
            <button id="resetLogs" class="px-3 py-2 rounded-md border text-sm text-rose-600">Reset Logs</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Modal Root -->
  <div id="modalRoot" class="fixed inset-0 flex items-center justify-center z-40 hidden"></div>

  <script>
    /* =========================
       Data model + localStorage
       ========================= */
    const STORAGE_KEY = 'skinDiaryData_v1';
    const DEFAULT_DATA = {
      profileName: '',
      notificationsEnabled: false,
      routines: [], // {id,name,when: 'morning'|'evening',time:'HH:MM',done:false,note:''}
      notes: [],
      history: [] // {date:'YYYY-MM-DD', completedCount, total}
    };

    const SKINCARE_CATALOG = [
      {id:'facewash', name:'Face Wash', usage:'Use morning & night after waking/sleeping', when:['morning','evening'], time:'07:30'},
      {id:'vitc', name:'Vitamin C Serum', usage:'Use morning before moisturizer', when:['morning'], time:'07:45'},
      {id:'moisturizer', name:'Moisturizer', usage:'Use morning & night', when:['morning','evening'], time:'07:50'},
      {id:'sunscreen', name:'Sunscreen SPF 30+', usage:'Use every morning before sun exposure', when:['morning'], time:'08:00'},
      {id:'retinol', name:'Retinol', usage:'Use at night only (doctor recommended)', when:['evening'], time:'22:00'},
      {id:'exfoliant', name:'Exfoliating Gel', usage:'Use 1-2x/week at night', when:['evening'], time:'20:30', freqPerWeek:2},
      {id:'eyecream', name:'Eye Cream', usage:'Use morning & night', when:['morning','evening'], time:'07:55'},
      {id:'mask', name:'Hydrating Mask', usage:'Use 1x/week in evening', when:['evening'], time:'19:30', freqPerWeek:1}
    ];

    function loadData(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return JSON.parse(JSON.stringify(DEFAULT_DATA));
        return JSON.parse(raw);
      }catch(e){
        return JSON.parse(JSON.stringify(DEFAULT_DATA));
      }
    }
    function saveData(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      renderAll();
    }
    let state = loadData();

    /* =========================
       Utilities
       ========================= */
    function todayStr(){ return new Date().toISOString().slice(0,10); }
    function el(tag, props={}, ...children){
      const e = document.createElement(tag);
      for(const k in props){
        if(k === 'class') e.className = props[k];
        else if(k.startsWith('data-')) e.setAttribute(k, props[k]);
        else e[k] = props[k];
      }
      children.forEach(c => { if(c!==null && c!==undefined) e.append(typeof c === 'string' ? document.createTextNode(c) : c); });
      return e;
    }

    /* =========================
       Rendering
       ========================= */
    function renderAll(){
      renderProfile();
      renderNotifToggle();
      renderRoutines();
      renderNotes();
      renderNextReminders();
      renderWeeklyChart();
    }

    // Profile button (input on click)
    function renderProfile(){
      const wrap = document.getElementById('profileWrap');
      wrap.innerHTML = '';
      const name = state.profileName.trim();
      const btn = el('button',{class:'px-4 py-2 rounded-full border bg-white/90 text-sm'}, name || 'Profile');
      btn.addEventListener('click', ()=>{
        const val = prompt('Masukkan nama profil:', state.profileName || '');
        if(val !== null){
          state.profileName = val.trim();
          saveData();
        }
      });
      wrap.appendChild(btn);
    }

    function renderNotifToggle(){
      const b = document.getElementById('notifToggle');
      b.textContent = state.notificationsEnabled ? 'Disable Notifications' : 'Enable Notifications';
    }

    // Routines rendering
    function renderRoutines(){
      const morningList = document.getElementById('morningList');
      const eveningList = document.getElementById('eveningList');
      morningList.innerHTML = '';
      eveningList.innerHTML = '';

      if(state.routines.length === 0){
        morningList.innerHTML = '<div class="text-sm text-gray-400">No routines. Click Start Routine to create one.</div>';
        eveningList.innerHTML = '<div class="text-sm text-gray-400">No routines. Click Start Routine to create one.</div>';
      } else {
        const morning = state.routines.filter(r=>r.when==='morning').sort((a,b)=>a.time.localeCompare(b.time));
        const evening = state.routines.filter(r=>r.when==='evening').sort((a,b)=>a.time.localeCompare(b.time));

        morning.forEach(it => morningList.appendChild(renderRoutineItem(it)));
        evening.forEach(it => eveningList.appendChild(renderRoutineItem(it)));
      }

      // progress
      const total = state.routines.length;
      const done = state.routines.filter(r=>r.done).length;
      const pct = total ? Math.round((done/total)*100) : 0;
      document.getElementById('progressBar').style.width = pct + '%';
      document.getElementById('progressText').textContent = `${done} / ${total} completed`;
    }

    function renderRoutineItem(item){
      const wrap = el('div',{class:'flex items-center justify-between p-3 bg-gray-50 rounded-md'});
      const left = el('div',{}, el('div',{class:'font-medium'}, item.name), el('div',{class:'text-xs text-gray-400'}, item.time + (item.note ? (' · ' + item.note) : '')));
      const right = el('div',{}, el('input',{type:'checkbox', checked:item.done}));
      wrap.appendChild(left); wrap.appendChild(right);
      right.querySelector('input').addEventListener('change', (e)=>{
        item.done = e.target.checked;
        saveTodayHistoryOnComplete();
        saveData();
      });
      return wrap;
    }

    // Notes
    function renderNotes(){
      const list = document.getElementById('noteList');
      list.innerHTML = '';
      if(state.notes.length === 0){
        list.textContent = 'No notes yet — add quick notes to generate logs.';
      } else {
        state.notes.slice().reverse().forEach(n => {
          const row = el('div',{class:'flex items-start justify-between p-3 bg-gray-50 rounded-md mb-2'},
            el('div',{}, el('div',{class:'text-sm'}, n.text), el('div',{class:'text-xs text-gray-400 mt-1'}, new Date(n.created).toLocaleString())),
            el('div',{}, el('button',{class:'text-sm px-2 py-1 rounded-md border'}, 'Delete'))
          );
          row.querySelector('button').addEventListener('click', ()=>{
            state.notes.splice(state.notes.indexOf(n),1);
            saveData();
          });
          list.appendChild(row);
        });
      }
    }

    // Next Reminders (combine evening into this)
    function renderNextReminders(){
      const wrap = document.getElementById('nextReminders');
      wrap.innerHTML = '';
      if(state.routines.length === 0){
        wrap.innerHTML = '<div class="text-sm text-gray-400">No reminders scheduled. Start a routine to create reminders.</div>';
        return;
      }
      const upcoming = state.routines.slice().sort((a,b)=>a.time.localeCompare(b.time));
      upcoming.forEach(it => {
        const row = el('div',{class:'flex items-center justify-between p-2 rounded-md bg-gray-50'}, el('div',{}, el('div',{class:'text-sm'}, it.name), el('div',{class:'text-xs text-gray-400'}, it.when)), el('div',{class:'text-sm text-rose-500'}, it.time));
        wrap.appendChild(row);
      });
    }

    // Weekly chart (canvas simple)
    function renderWeeklyChart(){
      const canvas = document.getElementById('weeklyChart');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.clientWidth * devicePixelRatio;
      canvas.height = canvas.clientHeight * devicePixelRatio;
      ctx.scale(devicePixelRatio, devicePixelRatio);

      const w = canvas.clientWidth;
      const h = canvas.clientHeight;
      ctx.clearRect(0,0,w,h);
      // build last 7 days labels and counts
      const days = [];
      const counts = [];
      for(let i=6;i>=0;i--){
        const d = new Date(); d.setDate(d.getDate()-i);
        const key = d.toISOString().slice(0,10);
        days.push(d.toLocaleDateString(undefined,{weekday:'short'}).slice(0,3));
        const rec = state.history.find(r=>r.date===key);
        counts.push(rec ? rec.completedCount : 0);
      }
      const max = Math.max(1, ...counts);
      const barW = Math.floor(w / days.length * 0.6);
      const gap = Math.floor((w - barW*days.length)/(days.length-1));
      for(let i=0;i<days.length;i++){
        const x = i*(barW+gap);
        const barH = Math.round((counts[i]/max) * (h - 30));
        ctx.fillStyle = '#fff7f7';
        ctx.fillRect(x + 4, h - 22 - barH, barW, barH);
        ctx.fillStyle = '#6b776f';
        ctx.font = '11px sans-serif';
        ctx.fillText(days[i], x + 6, h - 6);
      }
    }

    /* =========================
       Actions + Event listeners
       ========================= */

    // scroll nav
    document.querySelectorAll('button[data-scroll]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-scroll');
        const elNode = document.getElementById(id);
        if(elNode) elNode.scrollIntoView({behavior:'smooth', block:'start'});
        else window.scrollTo({top:0, behavior:'smooth'});
      });
    });

    // Start Routine modal
    document.getElementById('startRoutineBtn').addEventListener('click', openStartModal);

    function openStartModal(){
      const root = document.getElementById('modalRoot');
      root.innerHTML = '';
      root.classList.remove('hidden');
      root.classList.add('block');
      root.style.background = 'rgba(0,0,0,0.35)';

      const modal = el('div',{class:'bg-white rounded-lg p-6 w-[860px] max-w-[95%]'});
      const title = el('h3',{class:'text-lg font-semibold mb-2'}, 'Pilih semua skincare yang kamu gunakan');
      const desc = el('p',{class:'text-sm text-gray-500 mb-4'}, 'Pilih produk — jadwal akan dibuat otomatis berdasarkan petunjuk pemakaian (dokter).');

      const list = el('div',{class:'grid grid-cols-1 md:grid-cols-2 gap-3 max-h-[360px] overflow-auto mb-4'});
      SKINCARE_CATALOG.forEach(p=>{
        const row = el('label',{class:'flex items-start gap-3 p-3 rounded-md bg-gray-50 cursor-pointer'},
          el('input',{type:'checkbox','data-id':p.id}),
          el('div',{}, el('div',{class:'font-medium'}, p.name), el('div',{class:'text-xs text-gray-400'}, p.usage))
        );
        list.appendChild(row);
      });

      const controls = el('div',{class:'flex justify-end gap-3'},
        el('button',{class:'px-4 py-2 rounded-md border','id':'cancelModal'}, 'Cancel'),
        el('button',{class:'px-4 py-2 rounded-full bg-rose-400 text-white','id':'confirmModal'}, 'Start')
      );

      modal.appendChild(title); modal.appendChild(desc); modal.appendChild(list); modal.appendChild(controls);
      root.appendChild(modal);

      document.getElementById('cancelModal').addEventListener('click', closeModal);
      document.getElementById('confirmModal').addEventListener('click', ()=>{
        const checked = Array.from(list.querySelectorAll('input[type=checkbox]:checked')).map(c=>c.getAttribute('data-id'));
        if(checked.length === 0){ alert('Pilih minimal 1 produk.'); return; }
        const routines = [];
        checked.forEach(id=>{
          const prod = SKINCARE_CATALOG.find(x=>x.id===id);
          if(!prod) return;
          prod.when.forEach(w=>{
            const note = prod.freqPerWeek ? `(${prod.freqPerWeek}x/week)` : '';
            routines.push({id: `${prod.id}_${w}`, name: prod.name, when: w, time: prod.time, done:false, note});
          });
        });
        state.routines = routines;
        saveData();
        closeModal();
        document.getElementById('routines').scrollIntoView({behavior:'smooth'});
      });

      function closeModal(){
        root.classList.add('hidden');
        root.innerHTML = '';
      }
    }

    // view notes scroll
    document.getElementById('viewNotes').addEventListener('click', ()=> document.getElementById('notes').scrollIntoView({behavior:'smooth'}));

    // add quick note
    document.getElementById('addNoteBtn').addEventListener('click', ()=>{
      const t = prompt('Tambah catatan cepat:');
      if(t && t.trim()){
        state.notes.push({text:t.trim(), created: new Date().toISOString()});
        saveData();
      }
    });

    // notif toggle (requests browser permission; state persisted locally)
    document.getElementById('notifToggle').addEventListener('click', async ()=>{
      if(!state.notificationsEnabled){
        if('Notification' in window){
          try{
            const p = await Notification.requestPermission();
            if(p !== 'granted') alert('Izin notifikasi tidak diberikan — toggle tetap akan diaktifkan secara lokal.');
          }catch(e){}
        }
        state.notificationsEnabled = true;
      } else {
        state.notificationsEnabled = false;
      }
      saveData();
    });

    // Quick actions
    document.getElementById('markMorningDone').addEventListener('click', ()=>{
      state.routines.forEach(r=>{ if(r.when==='morning') r.done = true; });
      recordTodayHistory();
      saveData();
    });
    document.getElementById('markNightDone').addEventListener('click', ()=>{
      state.routines.forEach(r=>{ if(r.when==='evening') r.done = true; });
      recordTodayHistory();
      saveData();
    });
    document.getElementById('resetLogs').addEventListener('click', ()=>{
      if(!confirm('Reset akan menghapus semua data (profil, routines, notes, history) pada browser ini. Lanjutkan?')) return;
      state = JSON.parse(JSON.stringify(DEFAULT_DATA));
      saveData();
    });

    /* =========================
       History helpers
       ========================= */
    function saveTodayHistoryOnComplete(){
      const total = state.routines.length;
      const done = state.routines.filter(r=>r.done).length;
      if(total > 0 && done === total){
        recordTodayHistory();
      }
    }
    function recordTodayHistory(){
      const rec = {date: todayStr(), completedCount: state.routines.filter(r=>r.done).length, total: state.routines.length};
      const idx = state.history.findIndex(h=>h.date===rec.date);
      if(idx >= 0) state.history[idx] = rec; else state.history.push(rec);
    }

    /* =========================
       Initialization
       ========================= */
    renderAll();

    // small heartbeat refresh so UI updates if local changes happen
    setInterval(renderAll, 2500);

    // expose debug (optional)
    window.__skinDiary = { state, saveData, SKINCARE_CATALOG };

    // save before unload
    window.addEventListener('beforeunload', ()=> saveData());
  </script>
</body>
</html>
